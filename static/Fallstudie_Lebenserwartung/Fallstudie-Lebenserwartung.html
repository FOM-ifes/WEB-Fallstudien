---
title: "Prädiktoren der Lebenserwartung"
author: "Sebastian Sauer"
tags:
- Lebenserwartung
- Geovisualisierung
output:
  html_document:
    df_print: paged
    number_sections: yes
    toc: yes
  pdf_document:
    toc: yes
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<div id="präambel" class="section level1">
<h1>Präambel</h1>
<div id="forschungsfrage" class="section level2">
<h2>Forschungsfrage</h2>
<p>Die Lebenserwartung der Menschen variiert, wie jeder weiß. Die Variation wird u.a. erklärt durch das Land, in dem jemand lebt, aber auch durch die Zeit – in den letzten Jahrzehnten ist die Lebenserwartung zum Glück deutlich gestiegen. Allerdings nicht in jedem Jahr und in jedem Land in gleichem Maße. In dieser Fallstudie soll der Einfluss von Land, Region und Zeit auf die Lebenserwartung untersucht werden. Konkret soll die Lebenserwartung im Alter von 10 Jahren modelliert werden.</p>
</div>
<div id="daten" class="section level2">
<h2>Daten</h2>
<p>Die Daten stammen von <a href="https://ourworldindata.org">Our World in Data</a>, genauer gesagt aus <a href="https://ourworldindata.org/life-expectancy#a-comparative-perspective-life-expectancy-at-the-age-of-10">dieser Analyse</a>. Weitere Quellen sind <a href="https://ourworldindata.org/life-expectancy#data-sources">hier</a> dokumentiert.</p>
</div>
<div id="studiendesign" class="section level2">
<h2>Studiendesign</h2>
<p>Es handelt sich um eine retrospektive Beobachtungsstudie. Die Daten wurden ex post erhoben.</p>
</div>
</div>
<div id="datenanalyse" class="section level1">
<h1>Datenanalyse</h1>
<div id="setup" class="section level2">
<h2>Setup</h2>
<p>Zuerst <code>mosaic</code> laden; nicht vergessen! Falls eines der Pakete auf Ihrer Maschine nicht installiert ist, bitte mit <code>install.packages("name_des_pakets")</code> installieren.</p>
<pre class="r"><code>library(mosaic)
library(countrycode)
library(rnaturalearth)
library(tidyverse)</code></pre>
</div>
<div id="daten-importieren-und-aufbereiten" class="section level2">
<h2>Daten importieren und aufbereiten</h2>
</div>
<div id="importieren" class="section level2">
<h2>Importieren</h2>
<p>So können die Daten komfortabel in R importieren:</p>
<pre class="r"><code>exp_raw &lt;- read.csv(&quot;https://raw.githubusercontent.com/sebastiansauer/Statistiklehre/main/data/life-expectancy-at-age-10.csv&quot;)

head(exp_raw)</code></pre>
<pre><code>##        Entity Code Year e10..years.
## 1 Afghanistan  AFG 1950       39.58
## 2 Afghanistan  AFG 1955       41.08
## 3 Afghanistan  AFG 1960       42.41
## 4 Afghanistan  AFG 1965       43.68
## 5 Afghanistan  AFG 1970       44.98
## 6 Afghanistan  AFG 1975       46.44</code></pre>
<p>Ich habe die Tabelle <code>exp_raw</code> genannt, um zu verdeutlichen, dass es sich um die “rohen”, unbearbeiteten Daten handelt. Häufig muss man die Daten noch modifizieren, da bietet es sich an, klar anzuzeigen, was die unbehandelten Daten und was die behandelten Daten sind.</p>
<p>Die Spalte <code>e10..years.</code> fasst die Lebenserwartung zum Alter von 10 Jahren. Allerdings ist der Name der Spalte nicht so schön. Benennen wir die Spalte um:</p>
<pre class="r"><code>exp &lt;- exp_raw %&gt;% 
  rename(e10 = e10..years.)  # neu = alt</code></pre>
</div>
<div id="kontinente-hinzufügen" class="section level2">
<h2>Kontinente hinzufügen</h2>
<p>Es wäre doch schön, für jedes Land zu wissen, zu welchem Kontinent (oder Weltregion) es gehört. Natürlich kann man das händisch hinzufügen (z.B. in Excel). Aber komfortabler ist es, wenn man solche schnöde Arbeit den Computer erledigen lässt. In R gibt es ein Paket namens <code>countrycode</code> (und eine Funktion mit gleichem Namen), das die Arbeit für uns übernimmt. Hier bilden wir den Landesnamen auf das zugehörige Kontinent ab; alternativ hätten wir auch die Spalte <code>Code</code> verwenden können. Allerdings ist nicht ganz klar, um <em>welchen</em> Code es sich handelt (vielleicht <a href="https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes">ISO</a>). Das zeigt, das ein gutes Codebuch zu jedem Datensatz gehört!</p>
<pre class="r"><code>exp2 &lt;- exp %&gt;% 
  mutate(continent = countrycode(sourcevar = Entity,  # Spalte, in der das Land steht
                                 origin = &quot;country.name&quot;,  # Eingage: Name (nicht z.B. ISO-Code) des Landes
                                 destination = &quot;continent&quot;))  # gewünschte Ausgabe: Name des Kontinents</code></pre>
<pre><code>## Warning: Problem with `mutate()` input `continent`.
## ℹ Some values were not matched unambiguously: Channel Islands, Micronesia (country), Timor, World
## 
## ℹ Input `continent` is `countrycode(sourcevar = Entity, origin = &quot;country.name&quot;, destination = &quot;continent&quot;)`.</code></pre>
<pre><code>## Warning in countrycode(sourcevar = Entity, origin = &quot;country.name&quot;, destination = &quot;continent&quot;): Some values were not matched unambiguously: Channel Islands, Micronesia (country), Timor, World</code></pre>
<p>Dazu haben wir eine Spalte mit <code>mutate()</code> angelegt, die den Namen des Kontinents für jedes Land fasst. R informiert uns, dass einige Länder nicht einem Kontinent zugeordnet werden konnten. Schauen wir uns das genauer an. Wie viele Fälle liefern fehlende Werte zurück?</p>
<pre class="r"><code>exp2 %&gt;% 
  summarise(is_na_sum = is.na(continent) %&gt;% sum())</code></pre>
<pre><code>##   is_na_sum
## 1       120</code></pre>
<p>Schauen wir uns ein Beispiel näher an:</p>
<pre class="r"><code>exp2 %&gt;% 
  filter(Entity == &quot;Timor&quot;)</code></pre>
<pre><code>##    Entity Code Year   e10 continent
## 1   Timor  TLS 1950 40.43      &lt;NA&gt;
## 2   Timor  TLS 1955 41.90      &lt;NA&gt;
## 3   Timor  TLS 1960 43.35      &lt;NA&gt;
## 4   Timor  TLS 1965 44.80      &lt;NA&gt;
## 5   Timor  TLS 1970 46.19      &lt;NA&gt;
## 6   Timor  TLS 1975 41.14      &lt;NA&gt;
## 7   Timor  TLS 1980 46.19      &lt;NA&gt;
## 8   Timor  TLS 1985 49.85      &lt;NA&gt;
## 9   Timor  TLS 1990 51.91      &lt;NA&gt;
## 10  Timor  TLS 1995 55.36      &lt;NA&gt;
## 11  Timor  TLS 2000 57.80      &lt;NA&gt;
## 12  Timor  TLS 2005 61.24      &lt;NA&gt;
## 13  Timor  TLS 2010 61.99      &lt;NA&gt;
## 14  Timor  TLS 2015 62.91      &lt;NA&gt;
## 15  Timor  TLS 2020 63.73      &lt;NA&gt;
## 16  Timor  TLS 2025 64.43      &lt;NA&gt;
## 17  Timor  TLS 2030 65.08      &lt;NA&gt;
## 18  Timor  TLS 2035 65.72      &lt;NA&gt;
## 19  Timor  TLS 2040 66.34      &lt;NA&gt;
## 20  Timor  TLS 2045 66.91      &lt;NA&gt;
## 21  Timor  TLS 2050 67.55      &lt;NA&gt;
## 22  Timor  TLS 2055 68.15      &lt;NA&gt;
## 23  Timor  TLS 2060 68.77      &lt;NA&gt;
## 24  Timor  TLS 2065 69.40      &lt;NA&gt;
## 25  Timor  TLS 2070 70.01      &lt;NA&gt;
## 26  Timor  TLS 2075 70.60      &lt;NA&gt;
## 27  Timor  TLS 2080 71.33      &lt;NA&gt;
## 28  Timor  TLS 2085 72.03      &lt;NA&gt;
## 29  Timor  TLS 2090 72.72      &lt;NA&gt;
## 30  Timor  TLS 2095 73.39      &lt;NA&gt;</code></pre>
<p>Vielleicht klappt es mit der Übersetzung der Spalte <code>Code</code> besser? Gehen wir mal davon aus, dass es sich um ISO-3661-Codes handelt.</p>
<pre class="r"><code>exp2 &lt;- exp2 %&gt;% 
  mutate(continent2 = countrycode(sourcevar = Code,  # Spalte, in der das Land steht
                                 origin = &quot;iso3c&quot;,  # Eingage: Name (nicht z.B. ISO-Code) des Landes
                                 destination = &quot;continent&quot;))  # gewünschte Ausgabe: Name des Kontinents</code></pre>
<pre><code>## Warning: Problem with `mutate()` input `continent2`.
## ℹ Some values were not matched unambiguously: OWID_CIS, OWID_WRL
## 
## ℹ Input `continent2` is `countrycode(sourcevar = Code, origin = &quot;iso3c&quot;, destination = &quot;continent&quot;)`.</code></pre>
<pre><code>## Warning in countrycode(sourcevar = Code, origin = &quot;iso3c&quot;, destination = &quot;continent&quot;): Some values were not matched unambiguously: OWID_CIS, OWID_WRL</code></pre>
<pre class="r"><code>exp2 %&gt;% 
  summarise(is_na_sum = is.na(continent2) %&gt;% sum())</code></pre>
<pre><code>##   is_na_sum
## 1        60</code></pre>
<p>Besser; 60 fehlende Werte. Aber welche Fälle sind übrig? Schauen wir uns die mal an:</p>
<pre class="r"><code>exp2 %&gt;% 
  filter(is.na(continent2)) %&gt;% 
  distinct(Entity)</code></pre>
<pre><code>##            Entity
## 1 Channel Islands
## 2           World</code></pre>
<p>Auf Deutsch übersetzt heißt die Syntax oben:</p>
<pre><code>Hey R, nimm die Tabelle exp2 UND DANN  
filtere die Fälle, die keine Werte haben für continent2 UND DANN
zeige alle verschiedenen Werte für Entity</code></pre>
<p>Laut <a href="https://support.cybersource.com/s/article/What-is-the-country-code-for-the-Channel-Islands">dieser Quelle</a> gehören die Channel Islands zu UK (GB). Es ist vielleicht pragmatisch, dies einfach zu übernehmen.</p>
<pre class="r"><code>exp3 &lt;- exp2 %&gt;% 
  mutate(continent2 = as.character(continent2)) %&gt;% 
  mutate(continent2 = case_when(
    Entity == &quot;Channel Islands&quot; ~ &quot;Europe&quot;,
    Entity == &quot;World&quot; ~ &quot;World&quot;,
    TRUE ~ continent2))</code></pre>
<p>Prüfen wir, ob jetzt alle fehlenden Werte bei <code>continent2</code> beseitigt sind:</p>
<pre class="r"><code>exp3 %&gt;% 
  filter(is.na(continent2))</code></pre>
<pre><code>## [1] Entity     Code       Year       e10        continent  continent2
## &lt;0 rows&gt; (or 0-length row.names)</code></pre>
<p>Gut.</p>
</div>
<div id="was-ist-die-mittlere-lebenserwartung-pro-kontinent-im-jahr-2015-laut-den-daten" class="section level2">
<h2>Was ist die mittlere Lebenserwartung pro Kontinent im Jahr 2015 (laut den Daten)?</h2>
<p>Für welche Jahre liegen Daten vor?</p>
<pre class="r"><code>exp3 %&gt;% 
  distinct(Year) %&gt;% 
  pull()</code></pre>
<pre><code>##  [1] 1950 1955 1960 1965 1970 1975 1980 1985 1990 1995 2000 2005 2010 2015 2020
## [16] 2025 2030 2035 2040 2045 2050 2055 2060 2065 2070 2075 2080 2085 2090 2095
## [31] 1750 1755 1760 1765 1770 1775 1780 1785 1790 1795 1800 1805 1810 1815 1820
## [46] 1825 1830 1835 1840 1845 1850 1855 1860 1865 1870 1875 1880 1885 1890 1895
## [61] 1900 1905 1910 1915 1920 1925 1930 1935 1940 1945</code></pre>
<p>Möchte man die Daten nicht als Tabelle haben (braucht weniger Platz im Output), sondern aus der Tabelle eine Spalte <em>herausziehen</em>, kann man dafür den Befehl <code>pull()</code> verwenden.</p>
<p>Man sieht, dass die Daten offenbar nur in Fünf-Jahres-Schritten erhoben wurden. Wählen wir das Jahr 2015:</p>
<pre class="r"><code>exp_2015 &lt;- filter(exp3, Year == 2015)</code></pre>
<div id="deskriptivstatistik" class="section level3">
<h3>Deskriptivstatistik</h3>
<p>Berechnen wir die typischen Deskriptivstatistiken pro Kontinent:</p>
<pre class="r"><code>favstats(e10 ~ continent2, data = exp_2015)</code></pre>
<pre><code>##   continent2   min      Q1 median      Q3   max     mean       sd  n missing
## 1     Africa 43.30 55.8800 57.680 60.6300 71.13 58.29561 5.504426 57       0
## 2   Americas 59.20 65.7200 67.395 69.8175 73.58 67.47950 3.431801 40       0
## 3       Asia 57.81 62.4900 65.795 68.1125 74.73 65.75000 4.185182 50       0
## 4     Europe 61.12 66.4975 71.190 72.0950 73.97 69.27725 3.720629 40       0
## 5    Oceania 57.36 61.8900 65.160 68.4000 73.37 65.63615 4.852655 13       0
## 6      World 65.31 65.3100 65.310 65.3100 65.31 65.31000       NA  1       0</code></pre>
<p>Welche Länder gehören eigentlich zu “Oceania”?</p>
<pre class="r"><code>filter(exp_2015, continent == &quot;Oceania&quot;) %&gt;% 
  pull(Entity)</code></pre>
<pre><code>##  [1] &quot;Australia&quot;        &quot;Fiji&quot;             &quot;French Polynesia&quot; &quot;Guam&quot;            
##  [5] &quot;Kiribati&quot;         &quot;New Caledonia&quot;    &quot;New Zealand&quot;      &quot;Papua New Guinea&quot;
##  [9] &quot;Samoa&quot;            &quot;Solomon Islands&quot;  &quot;Tonga&quot;            &quot;Vanuatu&quot;</code></pre>
<p>Vermutlich würde es Sinn machen, Nord- und Südamerika getrennt auszuweisen.</p>
</div>
<div id="visualisierung" class="section level3">
<h3>Visualisierung</h3>
<pre class="r"><code>gf_boxplot(e10 ~ continent2, 
         data = exp_2015) %&gt;% 
  gf_point(stat = &quot;summary&quot;, 
           color = &quot;red&quot;, 
           size = 5) %&gt;% 
  gf_jitter(width = .1,
            alpha = .3) %&gt;% 
  gf_labs(x= &quot;Kontinent&quot;, y = &quot;Lebenserwartung im Alter von 10 Jahren&quot;,
          caption = &quot;Daten von &#39;Our World in Data&#39;&quot;,
          title = &quot;Lebenserwartung nach Kontinenten im Jahr 2015&quot;)</code></pre>
<pre><code>## No summary function supplied, defaulting to `mean_se()`</code></pre>
<p><img src="static/Fallstudie_Lebenserwartung/Fallstudie-Lebenserwartung_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Da <code>World</code> kein Kontinent ist, nehmen wir es heraus, aber zeichnen eine horizontale Linie für den Wert der Welt insgesamt.</p>
<pre class="r"><code>exp_2015 %&gt;% 
  filter(continent2 != &quot;World&quot;) %&gt;% 
  gf_boxplot(e10 ~ continent2) %&gt;% 
  gf_point(stat = &quot;summary&quot;, 
           color = &quot;red&quot;, 
           size = 5) %&gt;% 
  gf_jitter(width = .1,
            alpha = .3) %&gt;% 
  gf_labs(x= &quot;Kontinent&quot;, y = &quot;Lebenserwartung im Alter von 10 Jahren&quot;,
          caption = &quot;Daten von &#39;Our World in Data&#39;. Die horizontale Linie gibt den weltweiten Wert wieder.&quot;,
          title = &quot;Lebenserwartung nach Kontinenten im Jahr 2015.&quot;) %&gt;% 
  gf_hline(yintercept = ~65.3, linetype = &quot;dashed&quot;)</code></pre>
<pre><code>## No summary function supplied, defaulting to `mean_se()`</code></pre>
<p><img src="static/Fallstudie_Lebenserwartung/Fallstudie-Lebenserwartung_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
</div>
</div>
<div id="extremwerte" class="section level2">
<h2>Extremwerte</h2>
<p>Welche drei Länder weisen die geringste/höchste Lebenserwartung im Jahr 2015 auf?</p>
<pre class="r"><code>exp_2015 %&gt;% 
  arrange(e10) %&gt;%  # sortiert von klein nach groß bzgl. e10
  slice(1:3)</code></pre>
<pre><code>##          Entity Code Year   e10 continent continent2
## 1     Swaziland  SWZ 2015 43.30    Africa     Africa
## 2       Lesotho  LSO 2015 44.50    Africa     Africa
## 3 Cote d&#39;Ivoire  CIV 2015 50.14    Africa     Africa</code></pre>
<p><code>slice()</code> “schneidet” eine “Scheibe” an Zeilen heraus, hier 1 bis 3.</p>
<p>In gleicher Manier:</p>
<pre class="r"><code>exp_2015 %&gt;% 
  arrange(-e10) %&gt;% 
  slice</code></pre>
<pre><code>##                               Entity     Code Year   e10 continent continent2
## 1                          Hong Kong      HKG 2015 74.73      Asia       Asia
## 2                              Japan      JPN 2015 74.34      Asia       Asia
## 3                              Italy      ITA 2015 73.97    Europe     Europe
## 4                          Singapore      SGP 2015 73.91      Asia       Asia
## 5                        Switzerland      CHE 2015 73.91    Europe     Europe
## 6                              Chile      CHL 2015 73.58  Americas   Americas
## 7                              Spain      ESP 2015 73.50    Europe     Europe
## 8                          Australia      AUS 2015 73.37   Oceania    Oceania
## 9                            Iceland      ISL 2015 73.35    Europe     Europe
## 10                            Israel      ISR 2015 73.35      Asia       Asia
## 11                            France      FRA 2015 73.15    Europe     Europe
## 12                        Martinique      MTQ 2015 73.10  Americas   Americas
## 13                            Canada      CAN 2015 73.05  Americas   Americas
## 14                            Sweden      SWE 2015 73.02    Europe     Europe
## 15                       South Korea      KOR 2015 73.01      Asia       Asia
## 16                       New Zealand      NZL 2015 72.83   Oceania    Oceania
## 17                        Luxembourg      LUX 2015 72.47    Europe     Europe
## 18                        Guadeloupe      GLP 2015 72.43  Americas   Americas
## 19                       Netherlands      NLD 2015 72.38    Europe     Europe
## 20                           Austria      AUT 2015 72.35    Europe     Europe
## 21                            Norway      NOR 2015 72.35    Europe     Europe
## 22      United States Virgin Islands      VIR 2015 72.06  Americas   Americas
## 23                          Portugal      PRT 2015 72.01    Europe     Europe
## 24                   Channel Islands OWID_CIS 2015 71.94      &lt;NA&gt;     Europe
## 25                            Greece      GRC 2015 71.84    Europe     Europe
## 26                           Germany      DEU 2015 71.82    Europe     Europe
## 27                           Ireland      IRL 2015 71.79    Europe     Europe
## 28                           Belgium      BEL 2015 71.74    Europe     Europe
## 29                             Macao      MAC 2015 71.71      Asia       Asia
## 30                           Finland      FIN 2015 71.70    Europe     Europe
## 31                    United Kingdom      GBR 2015 71.62    Europe     Europe
## 32                             Malta      MLT 2015 71.56    Europe     Europe
## 33                          Slovenia      SVN 2015 71.27    Europe     Europe
## 34                     French Guiana      GUF 2015 71.25  Americas   Americas
## 35                           Reunion      REU 2015 71.13    Africa     Africa
## 36                            Cyprus      CYP 2015 71.12      Asia       Asia
## 37                           Denmark      DNK 2015 71.11    Europe     Europe
## 38                           Lebanon      LBN 2015 71.06      Asia       Asia
## 39                        Costa Rica      CRI 2015 71.04  Americas   Americas
## 40                           Mayotte      MYT 2015 70.99    Africa     Africa
## 41                              Guam      GUM 2015 70.86   Oceania    Oceania
## 42                       Puerto Rico      PRI 2015 70.71  Americas   Americas
## 43                              Cuba      CUB 2015 70.59  Americas   Americas
## 44                     United States      USA 2015 70.11  Americas   Americas
## 45                            Brunei      BRN 2015 69.92      Asia       Asia
## 46                            Panama      PAN 2015 69.72  Americas   Americas
## 47                           Albania      ALB 2015 69.61    Europe     Europe
## 48                           Curacao      CUW 2015 69.51  Americas   Americas
## 49                    Czech Republic      CZE 2015 69.34    Europe     Europe
## 50                             Qatar      QAT 2015 69.28      Asia       Asia
## 51                            Mexico      MEX 2015 69.20  Americas   Americas
## 52                           Uruguay      URY 2015 68.84  Americas   Americas
## 53                           Ecuador      ECU 2015 68.62  Americas   Americas
## 54                     New Caledonia      NCL 2015 68.40   Oceania    Oceania
## 55                            Poland      POL 2015 68.38    Europe     Europe
## 56                           Croatia      HRV 2015 68.30    Europe     Europe
## 57                          Maldives      MDV 2015 68.30      Asia       Asia
## 58                           Algeria      DZA 2015 68.15    Africa     Africa
## 59                              Oman      OMN 2015 68.14      Asia       Asia
## 60                           Vietnam      VNM 2015 68.13      Asia       Asia
## 61              United Arab Emirates      ARE 2015 68.06      Asia       Asia
## 62                         Argentina      ARG 2015 68.05  Americas   Americas
## 63                           Bahrain      BHR 2015 67.74      Asia       Asia
## 64                  French Polynesia      PYF 2015 67.73   Oceania    Oceania
## 65            Bosnia and Herzegovina      BIH 2015 67.67    Europe     Europe
## 66                            Turkey      TUR 2015 67.59      Asia       Asia
## 67                           Estonia      EST 2015 67.57    Europe     Europe
## 68                              Peru      PER 2015 67.55  Americas   Americas
## 69                         Nicaragua      NIC 2015 67.52  Americas   Americas
## 70               Antigua and Barbuda      ATG 2015 67.48  Americas   Americas
## 71                             China      CHN 2015 67.46      Asia       Asia
## 72                           Jamaica      JAM 2015 67.44  Americas   Americas
## 73                             Aruba      ABW 2015 67.35  Americas   Americas
## 74                          Slovakia      SVK 2015 67.14    Europe     Europe
## 75                        Montenegro      MNE 2015 67.12    Europe     Europe
## 76                              Iran      IRN 2015 67.09      Asia       Asia
## 77                            Brazil      BRA 2015 66.99  Americas   Americas
## 78                           Tunisia      TUN 2015 66.98    Africa     Africa
## 79                          Barbados      BRB 2015 66.96  Americas   Americas
## 80                           Bahamas      BHS 2015 66.92  Americas   Americas
## 81                           Morocco      MAR 2015 66.86    Africa     Africa
## 82                          Honduras      HND 2015 66.80  Americas   Americas
## 83                       Saint Lucia      LCA 2015 66.69  Americas   Americas
## 84                         Macedonia      MKD 2015 66.61    Europe     Europe
## 85                           Armenia      ARM 2015 66.54      Asia       Asia
## 86                           Georgia      GEO 2015 66.52      Asia       Asia
## 87                          Colombia      COL 2015 66.49  Americas   Americas
## 88                         Sri Lanka      LKA 2015 66.23      Asia       Asia
## 89                            Serbia      SRB 2015 66.16    Europe     Europe
## 90                Dominican Republic      DOM 2015 66.12  Americas   Americas
## 91                          Thailand      THA 2015 66.10      Asia       Asia
## 92                      Saudi Arabia      SAU 2015 66.06      Asia       Asia
## 93                           Romania      ROU 2015 66.02    Europe     Europe
## 94                         Venezuela      VEN 2015 66.02  Americas   Americas
## 95                           Hungary      HUN 2015 66.00    Europe     Europe
## 96                          Malaysia      MYS 2015 66.00      Asia       Asia
## 97                             Samoa      WSM 2015 65.96   Oceania    Oceania
## 98                            Jordan      JOR 2015 65.95      Asia       Asia
## 99                         Mauritius      MUS 2015 65.93    Africa     Africa
## 100                         Paraguay      PRY 2015 65.89  Americas   Americas
## 101                       Cape Verde      CPV 2015 65.81    Africa     Africa
## 102                           Kuwait      KWT 2015 65.64      Asia       Asia
## 103                       Bangladesh      BGD 2015 65.48      Asia       Asia
## 104                         Bulgaria      BGR 2015 65.33    Europe     Europe
## 105                            World OWID_WRL 2015 65.31      &lt;NA&gt;      World
## 106                        Palestine      PSE 2015 65.23      Asia       Asia
## 107                      El Salvador      SLV 2015 65.21  Americas   Americas
## 108                            Tonga      TON 2015 65.16   Oceania    Oceania
## 109                           Latvia      LVA 2015 65.03    Europe     Europe
## 110 Saint Vincent and the Grenadines      VCT 2015 64.87  Americas   Americas
## 111                          Grenada      GRD 2015 64.86  Americas   Americas
## 112                        Guatemala      GTM 2015 64.81  Americas   Americas
## 113                          Vanuatu      VUT 2015 64.60   Oceania    Oceania
## 114                       Seychelles      SYC 2015 64.58    Africa     Africa
## 115                       Azerbaijan      AZE 2015 64.50      Asia       Asia
## 116                          Bolivia      BOL 2015 64.48  Americas   Americas
## 117                            Libya      LBY 2015 64.19    Africa     Africa
## 118                        Lithuania      LTU 2015 64.11    Europe     Europe
## 119                       Tajikistan      TJK 2015 63.60      Asia       Asia
## 120                           Bhutan      BTN 2015 63.38      Asia       Asia
## 121                            Egypt      EGY 2015 63.37    Africa     Africa
## 122                            Nepal      NPL 2015 63.29      Asia       Asia
## 123                         Suriname      SUR 2015 63.23  Americas   Americas
## 124                      North Korea      PRK 2015 63.05      Asia       Asia
## 125              Trinidad and Tobago      TTO 2015 63.01  Americas   Americas
## 126                            Timor      TLS 2015 62.91      &lt;NA&gt;       Asia
## 127                         Pakistan      PAK 2015 62.76      Asia       Asia
## 128                          Moldova      MDA 2015 62.71    Europe     Europe
## 129                       Uzbekistan      UZB 2015 62.68      Asia       Asia
## 130                             Iraq      IRQ 2015 62.58      Asia       Asia
## 131                       Kyrgyzstan      KGZ 2015 62.46      Asia       Asia
## 132             Micronesia (country)      FSM 2015 62.46      &lt;NA&gt;    Oceania
## 133                            India      IND 2015 62.45      Asia       Asia
## 134                         Mongolia      MNG 2015 62.31      Asia       Asia
## 135                   Western Sahara      ESH 2015 62.19    Africa     Africa
## 136                         Cambodia      KHM 2015 62.14      Asia       Asia
## 137                          Belarus      BLR 2015 62.06    Europe     Europe
## 138                            Syria      SYR 2015 62.03      Asia       Asia
## 139                          Ukraine      UKR 2015 61.96    Europe     Europe
## 140                             Fiji      FJI 2015 61.89   Oceania    Oceania
## 141                  Solomon Islands      SLB 2015 61.83   Oceania    Oceania
## 142                           Belize      BLZ 2015 61.72  Americas   Americas
## 143                        Indonesia      IDN 2015 61.60      Asia       Asia
## 144            Sao Tome and Principe      STP 2015 61.57    Africa     Africa
## 145                             Laos      LAO 2015 61.24      Asia       Asia
## 146                           Russia      RUS 2015 61.12    Europe     Europe
## 147                          Senegal      SEN 2015 61.01    Africa     Africa
## 148                       Kazakhstan      KAZ 2015 60.89      Asia       Asia
## 149                         Kiribati      KIR 2015 60.82   Oceania    Oceania
## 150                      Philippines      PHL 2015 60.82      Asia       Asia
## 151                           Rwanda      RWA 2015 60.82    Africa     Africa
## 152                           Malawi      MWI 2015 60.63    Africa     Africa
## 153                          Myanmar      MMR 2015 60.61      Asia       Asia
## 154                         Ethiopia      ETH 2015 60.55    Africa     Africa
## 155                     Turkmenistan      TKM 2015 60.28      Asia       Asia
## 156                            Gabon      GAB 2015 60.13    Africa     Africa
## 157                       Madagascar      MDG 2015 60.01    Africa     Africa
## 158                            Sudan      SDN 2015 59.95    Africa     Africa
## 159                       Mauritania      MRT 2015 59.84    Africa     Africa
## 160                         Tanzania      TZA 2015 59.79    Africa     Africa
## 161                           Guyana      GUY 2015 59.71  Americas   Americas
## 162                            Yemen      YEM 2015 59.42      Asia       Asia
## 163                          Comoros      COM 2015 59.29    Africa     Africa
## 164                            Niger      NER 2015 59.24    Africa     Africa
## 165                            Haiti      HTI 2015 59.20  Americas   Americas
## 166                            Congo      COG 2015 58.79    Africa     Africa
## 167                            Kenya      KEN 2015 58.68    Africa     Africa
## 168                         Djibouti      DJI 2015 58.63    Africa     Africa
## 169                          Eritrea      ERI 2015 58.56    Africa     Africa
## 170                          Namibia      NAM 2015 57.94    Africa     Africa
## 171                      Afghanistan      AFG 2015 57.81      Asia       Asia
## 172     Democratic Republic of Congo      COD 2015 57.68    Africa     Africa
## 173                            Benin      BEN 2015 57.64    Africa     Africa
## 174                          Liberia      LBR 2015 57.62    Africa     Africa
## 175                           Zambia      ZMB 2015 57.59    Africa     Africa
## 176                            Ghana      GHA 2015 57.46    Africa     Africa
## 177                 Papua New Guinea      PNG 2015 57.36   Oceania    Oceania
## 178                           Uganda      UGA 2015 57.36    Africa     Africa
## 179                             Mali      MLI 2015 57.22    Africa     Africa
## 180                         Botswana      BWA 2015 57.17    Africa     Africa
## 181                     Burkina Faso      BFA 2015 56.88    Africa     Africa
## 182                           Gambia      GMB 2015 56.80    Africa     Africa
## 183                         Zimbabwe      ZWE 2015 56.72    Africa     Africa
## 184                             Togo      TGO 2015 56.65    Africa     Africa
## 185                           Guinea      GIN 2015 56.59    Africa     Africa
## 186                          Burundi      BDI 2015 56.34    Africa     Africa
## 187                    Guinea-Bissau      GNB 2015 55.88    Africa     Africa
## 188                Equatorial Guinea      GNQ 2015 55.66    Africa     Africa
## 189                          Somalia      SOM 2015 55.04    Africa     Africa
## 190                      South Sudan      SSD 2015 54.93    Africa     Africa
## 191                         Cameroon      CMR 2015 54.32    Africa     Africa
## 192                           Angola      AGO 2015 53.82    Africa     Africa
## 193         Central African Republic      CAF 2015 52.69    Africa     Africa
## 194                             Chad      TCD 2015 52.52    Africa     Africa
## 195                       Mozambique      MOZ 2015 52.18    Africa     Africa
## 196                          Nigeria      NGA 2015 51.62    Africa     Africa
## 197                     South Africa      ZAF 2015 50.72    Africa     Africa
## 198                     Sierra Leone      SLE 2015 50.20    Africa     Africa
## 199                    Cote d&#39;Ivoire      CIV 2015 50.14    Africa     Africa
## 200                          Lesotho      LSO 2015 44.50    Africa     Africa
## 201                        Swaziland      SWZ 2015 43.30    Africa     Africa</code></pre>
<p>Das Minuszeichen dreht die Sortierreihenfolge um, d.h. von groß zu klein.</p>
</div>
<div id="gibt-es-einen-zusammenhang-von-lebenserwartung-und-dem-jahr" class="section level2">
<h2>Gibt es einen Zusammenhang von Lebenserwartung und dem Jahr?</h2>
<div id="deskriptivstatistik-1" class="section level3">
<h3>Deskriptivstatistik</h3>
<pre class="r"><code>cor(e10 ~ Year, data = exp3)</code></pre>
<pre><code>## [1] NA</code></pre>
<p>Oh, es gibt fehlende Werte im Datensatz, daher streckt der Befehl <code>cor()</code> alle Viere von sich. Löschen wir mal alle Zeilen mit fehlenden Werten und hoffen, das wir nicht viele Daten verlieren:</p>
<pre class="r"><code>exp_ohne_na &lt;- exp3 %&gt;% 
  na.omit()</code></pre>
<p>Hm, ca. 500 Zeilen. Vielleicht doch lieber so:</p>
<pre class="r"><code>cor(e10 ~ Year, data = exp3 %&gt;% na.omit())</code></pre>
<pre><code>## [1] 0.7531835</code></pre>
</div>
<div id="inferenzstatistik" class="section level3">
<h3>Inferenzstatistik</h3>
<p>Inferenzstatistik macht hier wenig Sinn, da es unklar klar ist, auf welche Grundgesamtheit verallgemeinert werden soll. Alle Länder der Welt sind ja schon enthalten. Zu argumentieren, wir verallgemeinern auf alle Zeiten (Jahre) ist gewagt, denn unsere Stichprobe an Jahren ist sicher alles andere als eine Zufallsstichprobe aus der Menge aller Jahre der Welt … Verzichten wir also auf eine Inferenzstatistik.</p>
</div>
<div id="visualisierung-1" class="section level3">
<h3>Visualisierung</h3>
<pre class="r"><code>gf_point(e10 ~ Year, data = exp3, alpha = .2) %&gt;% 
  gf_smooth() %&gt;% 
  gf_facet_wrap(~ continent2)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39;</code></pre>
<pre><code>## Warning: Removed 419 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 419 rows containing missing values (geom_point).</code></pre>
<p><img src="static/Fallstudie_Lebenserwartung/Fallstudie-Lebenserwartung_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p><code>gf_facet_wrap()</code> macht ein “Teil-Bildchen” (Facette) pro Wert von Kontinent. Allerdings liegen die Daten für die meisten Länder erst ab ca. 1950 vor. Und die Prognosen in die Zukunft sehen wir mal kritisch. Vorhersagen sind bekanntlich schwierig. Vor allem, wenn sie die Zukunft betreffen, heißt es … <code>gf_smooth()</code> legt eine Kurve in “die Mitte” des Punkteschwarms: Für jeden X-Werte wird der mittlere Y-Wert berechnet (nahe X-Werte fließen auch noch etwas ein), und dann werden die Punkte mit einer Linie verbunden.</p>
<pre class="r"><code>exp3 %&gt;% 
  filter(Year &gt; 2016 &amp; Year &gt; 1949) %&gt;% 
  gf_jitter(e10 ~ Year, alpha = .2) %&gt;% 
  gf_smooth() %&gt;% 
  gf_facet_wrap(~ continent2)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="static/Fallstudie_Lebenserwartung/Fallstudie-Lebenserwartung_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>Wir sehen durchweg einen Anstieg der Lebenserwartung - sehr erfreulich! Freilich fußt der Anstieg auf unterschiedlichen Sockeln, also Ausgangsniveaus. Ist die Höhe des Anstiegs unterschiedlich je Kontinent? Für diese Frage modellieren wir die Lebenserwartung als Funktion des Kontinents und des Jahres.</p>
<p>Bleiben wir beim realistischen Teil der Daten:</p>
<pre class="r"><code>exp_1950_2015 &lt;- exp3 %&gt;% 
  filter(Year &gt; 2016 &amp; Year &gt; 1949)</code></pre>
</div>
<div id="modellierung" class="section level3">
<h3>Modellierung</h3>
<p>Berechnen wir dazu einige Modelle und vergleichen diese dann:</p>
<ol style="list-style-type: decimal">
<li>Das Nullmodell: Kein Prädiktor</li>
<li>Nur <code>Year</code> als Prädikator</li>
<li><code>Year</code> und <code>continent2</code>, aber ohne Interaktionseffekt</li>
<li><code>Year*continent2</code>, also mit Interaktionseffekt</li>
</ol>
<pre class="r"><code>lm0 &lt;- lm(e10 ~ 1, data = exp_1950_2015)
lm1 &lt;- lm(e10 ~ Year, data = exp_1950_2015)
lm2 &lt;- lm(e10 ~ Year + continent2, data = exp_1950_2015)
lm3 &lt;- lm(e10 ~ Year*continent2, data = exp_1950_2015)</code></pre>
<p>Betrachten wir die <span class="math inline">\(R^2\)</span>-Werte jedes Modells:</p>
<pre class="r"><code>rsquared(lm0) %&gt;% str()</code></pre>
<pre><code>##  num 0</code></pre>
<pre class="r"><code>r2s_vector &lt;- c(rsquared(lm0), rsquared(lm1), rsquared(lm2), rsquared(lm3))
r2s_vector %&gt;% str()</code></pre>
<pre><code>##  num [1:4] 0 0.219 0.531 0.532</code></pre>
<p>Um die Werte in einer kleiner Grafik zu zeigen, erstellen wir zuerst eine Tabelle (<code>tibble()</code>), weil <code>gf_XXX()</code> nur Spaß an Tabellen hat.</p>
<pre class="r"><code>r2s &lt;- tibble(Modellname = c(&quot;lm0&quot;, &quot;lm1&quot;, &quot;lm2&quot;, &quot;lm3&quot;),
              r2s = r2s_vector)
r2s</code></pre>
<pre><code>## # A tibble: 4 x 2
##   Modellname   r2s
##   &lt;chr&gt;      &lt;dbl&gt;
## 1 lm0        0    
## 2 lm1        0.219
## 3 lm2        0.531
## 4 lm3        0.532</code></pre>
<p>Und jetzt das Diagramm:</p>
<pre class="r"><code>gf_point(r2s ~ Modellname, data = r2s, size = 4) %&gt;% 
  gf_line(group = ~1)  # Es gibt nur eine Gruppe, also alle Punkte sollen verbunden werden</code></pre>
<p><img src="static/Fallstudie_Lebenserwartung/Fallstudie-Lebenserwartung_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Wie man sieht, ist der Zuwachs an erklärter Varianz von <code>lm2</code> auf <code>lm3</code> nicht groß. Der Interaktionseffekt scheint also nicht stark zu sein. Besser wir verzichten auf ihn und resümieren, dass die Daten eher die Hypothese stützen, dass der Zuwachs in Lebenserwartung gleich oder ähnlich groß ist zwischen den Kontinenten.</p>
<p>Wir können die Güte der Modelle bzw. die <em>Unterschiede</em> der Güte auf Signifikanz testen. Genau genommen werden die Likelihoods der Modelle verglichen und anhand der Freiheitsgrade normiert. Aber lassen wir die technischen Details an dieser Stelle. Diesen Modellvergleich können anhand der Funktion <code>anova()</code> durchführen, der uns die Quadratsummen zurückliefert und einen p-Wert (letzte Spalte).</p>
<pre class="r"><code>anova(lm0, lm1, lm2, lm3)</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Model 1: e10 ~ 1
## Model 2: e10 ~ Year
## Model 3: e10 ~ Year + continent2
## Model 4: e10 ~ Year * continent2
##   Res.Df    RSS Df Sum of Sq         F Pr(&gt;F)    
## 1   3215 133019                                  
## 2   3214 103875  1     29145 1500.3578 &lt;2e-16 ***
## 3   3209  62394  5     41481  427.0882 &lt;2e-16 ***
## 4   3204  62238  5       156    1.6039 0.1555    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Wir sehen, dass das letzte Modell (<code>Model 4</code>) nicht signifikant besser ist als das vorherige Modell. Das bestärkt unseren Schluss, die <span class="math inline">\(H_0\)</span> der Gleichheit der Modellgüte der beiden Modelle, nicht zu verwerfen.</p>
</div>
</div>
</div>
<div id="geovisualisierung" class="section level1">
<h1>Geovisualisierung</h1>
<div id="weltkarte-zeichnen" class="section level2">
<h2>Weltkarte zeichnen</h2>
<p>Analysiert man Länder (oder allgemeiner: Gegenden) der Erde, so bietet sich eine Geo-Visualisierung - wie eine Weltkarte - an. Das lässt sich recht einfach mit R bewerkstelligen.</p>
<p>Im Paket <code>rnaturalearth</code> sind die Weltkarten gespeichert. Ziehen wir uns die Länder der “natural earth” (ne) zunächst heraus:</p>
<pre class="r"><code>world &lt;- ne_countries(scale = &quot;medium&quot;, returnclass = &quot;sf&quot;)</code></pre>
<p>Die Tabelle ist sehr umfangreich; viele interessante Daten sind vorhanden. Die Geo-Daten verstecken sich in der Spalte <code>geometry</code>. Die technischen Details interessieren uns hier nicht.</p>
<pre class="r"><code>str(world)</code></pre>
<pre><code>## Classes &#39;sf&#39; and &#39;data.frame&#39;:   241 obs. of  64 variables:
##  $ scalerank : int  3 1 1 1 1 3 3 1 1 1 ...
##  $ featurecla: chr  &quot;Admin-0 country&quot; &quot;Admin-0 country&quot; &quot;Admin-0 country&quot; &quot;Admin-0 country&quot; ...
##  $ labelrank : num  5 3 3 6 6 6 6 4 2 6 ...
##  $ sovereignt: chr  &quot;Netherlands&quot; &quot;Afghanistan&quot; &quot;Angola&quot; &quot;United Kingdom&quot; ...
##  $ sov_a3    : chr  &quot;NL1&quot; &quot;AFG&quot; &quot;AGO&quot; &quot;GB1&quot; ...
##  $ adm0_dif  : num  1 0 0 1 0 1 0 0 0 0 ...
##  $ level     : num  2 2 2 2 2 2 2 2 2 2 ...
##  $ type      : chr  &quot;Country&quot; &quot;Sovereign country&quot; &quot;Sovereign country&quot; &quot;Dependency&quot; ...
##  $ admin     : chr  &quot;Aruba&quot; &quot;Afghanistan&quot; &quot;Angola&quot; &quot;Anguilla&quot; ...
##  $ adm0_a3   : chr  &quot;ABW&quot; &quot;AFG&quot; &quot;AGO&quot; &quot;AIA&quot; ...
##  $ geou_dif  : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ geounit   : chr  &quot;Aruba&quot; &quot;Afghanistan&quot; &quot;Angola&quot; &quot;Anguilla&quot; ...
##  $ gu_a3     : chr  &quot;ABW&quot; &quot;AFG&quot; &quot;AGO&quot; &quot;AIA&quot; ...
##  $ su_dif    : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ subunit   : chr  &quot;Aruba&quot; &quot;Afghanistan&quot; &quot;Angola&quot; &quot;Anguilla&quot; ...
##  $ su_a3     : chr  &quot;ABW&quot; &quot;AFG&quot; &quot;AGO&quot; &quot;AIA&quot; ...
##  $ brk_diff  : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ name      : chr  &quot;Aruba&quot; &quot;Afghanistan&quot; &quot;Angola&quot; &quot;Anguilla&quot; ...
##  $ name_long : chr  &quot;Aruba&quot; &quot;Afghanistan&quot; &quot;Angola&quot; &quot;Anguilla&quot; ...
##  $ brk_a3    : chr  &quot;ABW&quot; &quot;AFG&quot; &quot;AGO&quot; &quot;AIA&quot; ...
##  $ brk_name  : chr  &quot;Aruba&quot; &quot;Afghanistan&quot; &quot;Angola&quot; &quot;Anguilla&quot; ...
##  $ brk_group : chr  NA NA NA NA ...
##  $ abbrev    : chr  &quot;Aruba&quot; &quot;Afg.&quot; &quot;Ang.&quot; &quot;Ang.&quot; ...
##  $ postal    : chr  &quot;AW&quot; &quot;AF&quot; &quot;AO&quot; &quot;AI&quot; ...
##  $ formal_en : chr  &quot;Aruba&quot; &quot;Islamic State of Afghanistan&quot; &quot;People&#39;s Republic of Angola&quot; NA ...
##  $ formal_fr : chr  NA NA NA NA ...
##  $ note_adm0 : chr  &quot;Neth.&quot; NA NA &quot;U.K.&quot; ...
##  $ note_brk  : chr  NA NA NA NA ...
##  $ name_sort : chr  &quot;Aruba&quot; &quot;Afghanistan&quot; &quot;Angola&quot; &quot;Anguilla&quot; ...
##  $ name_alt  : chr  NA NA NA NA ...
##  $ mapcolor7 : num  4 5 3 6 1 4 1 2 3 3 ...
##  $ mapcolor8 : num  2 6 2 6 4 1 4 1 1 1 ...
##  $ mapcolor9 : num  2 8 6 6 1 4 1 3 3 2 ...
##  $ mapcolor13: num  9 7 1 3 6 6 8 3 13 10 ...
##  $ pop_est   : num  103065 28400000 12799293 14436 3639453 ...
##  $ gdp_md_est: num  2258 22270 110300 109 21810 ...
##  $ pop_year  : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ lastcensus: num  2010 1979 1970 NA 2001 ...
##  $ gdp_year  : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ economy   : chr  &quot;6. Developing region&quot; &quot;7. Least developed region&quot; &quot;7. Least developed region&quot; &quot;6. Developing region&quot; ...
##  $ income_grp: chr  &quot;2. High income: nonOECD&quot; &quot;5. Low income&quot; &quot;3. Upper middle income&quot; &quot;3. Upper middle income&quot; ...
##  $ wikipedia : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ fips_10   : chr  NA NA NA NA ...
##  $ iso_a2    : chr  &quot;AW&quot; &quot;AF&quot; &quot;AO&quot; &quot;AI&quot; ...
##  $ iso_a3    : chr  &quot;ABW&quot; &quot;AFG&quot; &quot;AGO&quot; &quot;AIA&quot; ...
##  $ iso_n3    : chr  &quot;533&quot; &quot;004&quot; &quot;024&quot; &quot;660&quot; ...
##  $ un_a3     : chr  &quot;533&quot; &quot;004&quot; &quot;024&quot; &quot;660&quot; ...
##  $ wb_a2     : chr  &quot;AW&quot; &quot;AF&quot; &quot;AO&quot; NA ...
##  $ wb_a3     : chr  &quot;ABW&quot; &quot;AFG&quot; &quot;AGO&quot; NA ...
##  $ woe_id    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ adm0_a3_is: chr  &quot;ABW&quot; &quot;AFG&quot; &quot;AGO&quot; &quot;AIA&quot; ...
##  $ adm0_a3_us: chr  &quot;ABW&quot; &quot;AFG&quot; &quot;AGO&quot; &quot;AIA&quot; ...
##  $ adm0_a3_un: num  NA NA NA NA NA NA NA NA NA NA ...
##  $ adm0_a3_wb: num  NA NA NA NA NA NA NA NA NA NA ...
##  $ continent : chr  &quot;North America&quot; &quot;Asia&quot; &quot;Africa&quot; &quot;North America&quot; ...
##  $ region_un : chr  &quot;Americas&quot; &quot;Asia&quot; &quot;Africa&quot; &quot;Americas&quot; ...
##  $ subregion : chr  &quot;Caribbean&quot; &quot;Southern Asia&quot; &quot;Middle Africa&quot; &quot;Caribbean&quot; ...
##  $ region_wb : chr  &quot;Latin America &amp; Caribbean&quot; &quot;South Asia&quot; &quot;Sub-Saharan Africa&quot; &quot;Latin America &amp; Caribbean&quot; ...
##  $ name_len  : num  5 11 6 8 7 5 7 20 9 7 ...
##  $ long_len  : num  5 11 6 8 7 13 7 20 9 7 ...
##  $ abbrev_len: num  5 4 4 4 4 5 4 6 4 4 ...
##  $ tiny      : num  4 NA NA NA NA 5 5 NA NA NA ...
##  $ homepart  : num  NA 1 1 NA 1 NA 1 1 1 1 ...
##  $ geometry  :sfc_MULTIPOLYGON of length 241; first list element: List of 1
##   ..$ :List of 1
##   .. ..$ : num [1:10, 1:2] -69.9 -69.9 -69.9 -70 -70.1 ...
##   ..- attr(*, &quot;class&quot;)= chr [1:3] &quot;XY&quot; &quot;MULTIPOLYGON&quot; &quot;sfg&quot;
##  - attr(*, &quot;sf_column&quot;)= chr &quot;geometry&quot;
##  - attr(*, &quot;agr&quot;)= Factor w/ 3 levels &quot;constant&quot;,&quot;aggregate&quot;,..: NA NA NA NA NA NA NA NA NA NA ...
##   ..- attr(*, &quot;names&quot;)= chr [1:63] &quot;scalerank&quot; &quot;featurecla&quot; &quot;labelrank&quot; &quot;sovereignt&quot; ...</code></pre>
<p>Wir haben den Befehl angewiesen, dass wir keine super genauen Grenzen benötigen, sondern dass uns eine mittlere Genauigkeit ausreicht. Das Datenformat nennt sich hier <code>sf</code> (simple feature), was zur Zeit ein Standardformat ist, um geografische Daten (GPS-Koordinaten für Grenzen und Punkte etc.) zu speichern. Aber wie gesagt, die technischen Details sind hier nicht interessant für uns. Mit dem Befehl <code>gf_sf</code> lassen sich dann Geo-Daten plotten:</p>
<pre class="r"><code>gf_sf(data = world)</code></pre>
<p><img src="static/Fallstudie_Lebenserwartung/Fallstudie-Lebenserwartung_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
</div>
<div id="karte-einfärben-choropleth" class="section level2">
<h2>Karte einfärben (Choropleth)</h2>
<p>Damit wir die Länder entsprechend ihrer Lebenserwartung einfärben können, müssen wir die Tabelle mit den Geo-Daten und die Tabelle mit den Lebensdaten zusammenführen. Das besorgt der Befehl <code>full_join()</code>. Damit der Befehl weiß, welche Zeilen zusammen gehören, erklären wir ihm “Füge gleiche Länder zusammen, dazu schaue in der Spalte <code>Entity</code> bzw. in der Spalte <code>sovereignt</code> (Tabelle <code>world</code>)”.</p>
<pre class="r"><code>exp_2015_joined &lt;- world %&gt;% 
  left_join(exp_2015, by = c(&quot;sovereignt&quot; = &quot;Entity&quot;))</code></pre>
<p>Das eigentliche Plotten ist schnell erledigt:</p>
<pre class="r"><code>gf_sf(fill = ~e10, data = exp_2015_joined) </code></pre>
<p><img src="static/Fallstudie_Lebenserwartung/Fallstudie-Lebenserwartung_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>Praktischerweise findet <code>gg_sf()</code> die Geo-Daten selbständig in der Tabelle, wir müssen nicht extra erklären, welche Spalte gemeint ist. Sehr komfortabel.</p>
<p>Das Farbschema könnte noch schöner sein:</p>
<pre class="r"><code>gf_sf(fill = ~e10, data = exp_2015_joined) %&gt;% 
  gf_refine(scale_fill_viridis_c()) %&gt;% 
  gf_labs(fill = &quot;Lebenserwartung&quot;,
          title = &quot;Lebenserwatung im Alter von 10 Jahren&quot;)</code></pre>
<p><img src="static/Fallstudie_Lebenserwartung/Fallstudie-Lebenserwartung_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>Viel besser. Mit <code>gf_refine()</code> “verfeinern` wir das Diagramm. In diesem Fall besteht das Verfeinern im Ändern des Farbschemas (wie nehmen <em>Viridis</em>), um die Füllfarbe zu ändern. Da es sich um eine kontinuierliche Variable handelt (d.h. metrisch), soll ein kontinuierliches Farbschema (mit fließenden, weichen Übergangen) verwendet werden (”_c" wie continuous).</p>
<p>Halt! Für die USA gibt es keine Werte! Kann das sein? Das ist ein gutes Beispiel dafür, dass eine Datenanalyse ein iterativer Prozess ist, d.h. einzelne Schritte - wie Datenvorverarbeitung - müssen immer wieder ausgeführt werden.</p>
</div>
</div>
<div id="auf-der-suche-nach-den-usa" class="section level1">
<h1>Auf der Suche nach den USA</h1>
<p>Versuchen wir, die USA in den Daten zu finden:</p>
<pre class="r"><code>exp3 %&gt;% 
  filter(str_detect(Entity, &quot;USA|United States&quot;))</code></pre>
<pre><code>##                          Entity Code Year   e10 continent continent2
## 1                 United States  USA 1950 61.28  Americas   Americas
## 2                 United States  USA 1955 62.06  Americas   Americas
## 3                 United States  USA 1960 62.32  Americas   Americas
## 4                 United States  USA 1965 62.34  Americas   Americas
## 5                 United States  USA 1970 62.94  Americas   Americas
## 6                 United States  USA 1975 64.52  Americas   Americas
## 7                 United States  USA 1980 65.43  Americas   Americas
## 8                 United States  USA 1985 65.86  Americas   Americas
## 9                 United States  USA 1990 66.49  Americas   Americas
## 10                United States  USA 1995 67.16  Americas   Americas
## 11                United States  USA 2000 67.83  Americas   Americas
## 12                United States  USA 2005 68.79  Americas   Americas
## 13                United States  USA 2010 69.47  Americas   Americas
## 14                United States  USA 2015 70.11  Americas   Americas
## 15                United States  USA 2020 70.80  Americas   Americas
## 16                United States  USA 2025 71.50  Americas   Americas
## 17                United States  USA 2030 72.19  Americas   Americas
## 18                United States  USA 2035 72.94  Americas   Americas
## 19                United States  USA 2040 73.65  Americas   Americas
## 20                United States  USA 2045 74.30  Americas   Americas
## 21                United States  USA 2050 74.88  Americas   Americas
## 22                United States  USA 2055 75.45  Americas   Americas
## 23                United States  USA 2060 76.00  Americas   Americas
## 24                United States  USA 2065 76.51  Americas   Americas
## 25                United States  USA 2070 77.04  Americas   Americas
## 26                United States  USA 2075 77.55  Americas   Americas
## 27                United States  USA 2080 78.06  Americas   Americas
## 28                United States  USA 2085 78.54  Americas   Americas
## 29                United States  USA 2090 79.03  Americas   Americas
## 30                United States  USA 2095 79.52  Americas   Americas
## 31 United States Virgin Islands  VIR 1950 54.52  Americas   Americas
## 32 United States Virgin Islands  VIR 1955 56.97  Americas   Americas
## 33 United States Virgin Islands  VIR 1960 58.30  Americas   Americas
## 34 United States Virgin Islands  VIR 1965 59.86  Americas   Americas
## 35 United States Virgin Islands  VIR 1970 61.43  Americas   Americas
## 36 United States Virgin Islands  VIR 1975 62.95  Americas   Americas
## 37 United States Virgin Islands  VIR 1980 64.12  Americas   Americas
## 38 United States Virgin Islands  VIR 1985 65.56  Americas   Americas
## 39 United States Virgin Islands  VIR 1990 66.88  Americas   Americas
## 40 United States Virgin Islands  VIR 1995 68.13  Americas   Americas
## 41 United States Virgin Islands  VIR 2000 69.19  Americas   Americas
## 42 United States Virgin Islands  VIR 2005 69.90  Americas   Americas
## 43 United States Virgin Islands  VIR 2010 70.98  Americas   Americas
## 44 United States Virgin Islands  VIR 2015 72.06  Americas   Americas
## 45 United States Virgin Islands  VIR 2020 73.11  Americas   Americas
## 46 United States Virgin Islands  VIR 2025 74.05  Americas   Americas
## 47 United States Virgin Islands  VIR 2030 74.86  Americas   Americas
## 48 United States Virgin Islands  VIR 2035 75.57  Americas   Americas
## 49 United States Virgin Islands  VIR 2040 76.24  Americas   Americas
## 50 United States Virgin Islands  VIR 2045 76.89  Americas   Americas
## 51 United States Virgin Islands  VIR 2050 77.49  Americas   Americas
## 52 United States Virgin Islands  VIR 2055 78.09  Americas   Americas
## 53 United States Virgin Islands  VIR 2060 78.62  Americas   Americas
## 54 United States Virgin Islands  VIR 2065 79.16  Americas   Americas
## 55 United States Virgin Islands  VIR 2070 79.67  Americas   Americas
## 56 United States Virgin Islands  VIR 2075 80.18  Americas   Americas
## 57 United States Virgin Islands  VIR 2080 80.68  Americas   Americas
## 58 United States Virgin Islands  VIR 2085 81.20  Americas   Americas
## 59 United States Virgin Islands  VIR 2090 81.72  Americas   Americas
## 60 United States Virgin Islands  VIR 2095 82.24  Americas   Americas</code></pre>
<p>die USA existieren also doch. Übrigens: <code>str_detect(spalte, suchterm)</code> liefert für jeden Wert von <code>spalte</code> zurück, ob sich der Suchterm (<code>suchterm</code>) darin befindet. Man bekommt also einen Vektor mit <code>TRUE, FALSE, TRUE, ..." und so weiter.</code>filter()` erlaubt, so einen logischen Vektor als Grundlage des Filterns herzunehmen.</p>
<p>Schauen wir, wie viele Länder zu unseren Suchterm passen (also <code>TRUE</code> zurückliefern):</p>
<pre class="r"><code>exp3 %&gt;% 
  filter(str_detect(Entity, &quot;USA|United States&quot;)) %&gt;% 
  pull(Entity) %&gt;% 
  unique()  # zeigt nur unterschiedliche (unique) Werte an</code></pre>
<pre><code>## [1] &quot;United States&quot;                &quot;United States Virgin Islands&quot;</code></pre>
<p>Aha, “United States” und die “Virgin Islands”.</p>
<p>Schauen wir mal nach, ob es die USA auch in der Tabelle <code>world</code> gibt:</p>
<pre class="r"><code>world %&gt;% 
  select(sovereignt) %&gt;% 
  filter(str_detect(sovereignt, &quot;USA|United States&quot;)) %&gt;% 
  pull(sovereignt) %&gt;% 
  unique()</code></pre>
<pre><code>## [1] &quot;United States of America&quot;</code></pre>
<p>Ah - die USA heißen hier “United States of America”. Das ist nicht exakt zu “United States” aus <code>exp3</code>. Daher hat das Verheiraten (der <code>full_join()</code>) oben nicht funktioniert. Besser wir nehmen den ISO-Code zum Vereinigen. Codes sind (hoffentlich) “bruchsicher”, so dass das Vereinigen klappen sollte. Der relevant Code scheint in Spalte <code>adm0_a3</code> zu Hause zu sein:</p>
<pre class="r"><code>exp_2015_joined &lt;- world %&gt;% 
  left_join(exp_2015, by = c(&quot;adm0_a3&quot; = &quot;Code&quot;))</code></pre>
<p>Und Plotten:</p>
<pre class="r"><code>gf_sf(fill = ~e10, data = exp_2015_joined) %&gt;% 
  gf_refine(scale_fill_viridis_c())</code></pre>
<p><img src="static/Fallstudie_Lebenserwartung/Fallstudie-Lebenserwartung_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>Hat funktioniert!</p>
</div>
